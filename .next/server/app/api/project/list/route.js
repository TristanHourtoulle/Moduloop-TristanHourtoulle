"use strict";(()=>{var e={};e.id=252,e.ids=[252],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},83589:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>R,routeModule:()=>E,serverHooks:()=>f,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>w});var s={};t.r(s),t.d(s,{DELETE:()=>l,GET:()=>d,POST:()=>c,PUT:()=>p});var o=t(95419),u=t(69108),n=t(99678),a=t(7727),i=t(84586);async function c(e){try{return Response.json({success:!0},{status:200})}catch(e){return console.error("Erreur lors de l'insertion de l'utilisateur:",e),Response.json({success:!1,error:e},{status:500})}}async function d(e){try{let r;let t=e.nextUrl.searchParams.get("id")||"",s=await a.Z.query("SELECT * FROM projects WHERE user_id = $1 ORDER BY updated_at DESC;",[t]);return 0==s.rowCount&&(r=JSON.stringify({})),r=s.rows,Response.json({success:!0,data:r},{status:200})}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration de tous les projets: ",e),Response.json({success:!1,error:e},{status:500})}}async function p(e){try{return Response.json({success:!0},{status:200})}catch(e){return console.error("Erreur lors de l'insertion de l'utilisateur:",e),Response.json({success:!1,error:e},{status:500})}}async function l(e){try{let r=e.nextUrl.searchParams,t=r.get("id_project")||"",s=r.get("id_product")||"";if(""===t||""===s)throw Error("Missing parameters for DELETE request.");{let e=await a.Z.query("SELECT * FROM projects WHERE id = $1;",[t]);if(0===e.rowCount)throw Error("Project with this User not found.");{let r=e.rows[0].products,o=(0,i.DC)(Number(s),r);if(o===r)throw Error("Product not found in project.");{let e=await a.Z.query("UPDATE projects SET products = $1 WHERE id = $2 RETURNING *;",[JSON.stringify(o),t]);if(!e)throw Error("Error while updating project.");let r=e.rows[0];return Response.json({success:!0,data:r},{status:200})}}}}catch(e){return console.error("Erreur lors de l'insertion de l'utilisateur:",e),Response.json({success:!1,error:e},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/project/list/route",pathname:"/api/project/list",filename:"route",bundlePath:"app/api/project/list/route"},resolvedPagePath:"C:\\Users\\trist\\Moduloop\\Moduloop-TristanHourtoulle\\app\\api\\project\\list\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:j,serverHooks:f,headerHooks:h,staticGenerationBailout:w}=E,m="/api/project/list/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:j})}},7727:(e,r,t)=>{t.d(r,{Z:()=>u});let{Pool:s}=t(35900),o=new s({host:"localhost",user:"postgres",password:"root",database:"Moduloop"});o.query(`
    CREATE TRIGGER update_projects_modtime
    BEFORE UPDATE ON projects
    FOR EACH ROW
    EXECUTE PROCEDURE update_modified_column();
`,(e,r)=>{e&&console.error(e)});let u=o},84586:(e,r,t)=>{function s(e,r){let t=null;if(r.products){for(let s of r.products)if(Number(s.product.id)==Number(e.product.id)){t={product:e.product,idProject:e.idProject,qNew:e.qNew+s.qNew,qUsed:e.qUsed+s.qUsed,addOn:s.addOn,updatedOn:e.updatedOn};break}}return t}function o(e,r){let t=[];for(let s of r)s.product.id!==e&&t.push(s);return t}t.d(r,{DC:()=>o,yl:()=>s})},95419:(e,r,t)=>{e.exports=t(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638],()=>t(83589));module.exports=s})();
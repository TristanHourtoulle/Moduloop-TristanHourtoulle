"use strict";(()=>{var e={};e.id=569,e.ids=[569],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},85223:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>R,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>E,staticGenerationBailout:()=>j});var o={};t.r(o),t.d(o,{POST:()=>p});var u=t(95419),d=t(69108),s=t(99678),a=t(7727),i=t(84586),n=t(97754);async function p(e){let r=await e.json();try{let e=await a.Z.query("SELECT * FROM products WHERE id = $1",[r.product.id]);if(0===e.rowCount)throw Error("Le produit n'existe pas");{let t={product:(0,n.Rl)(e.rows[0]),idProject:r.idProject,qNew:r.qNew,qUsed:r.qUsed,addOn:Date.now().toString(),updatedOn:Date.now().toString()};if(e=await a.Z.query("SELECT * FROM projects WHERE id = $1",[r.idProject]),0===e.rowCount)throw Error("Le projet n'existe pas");{let o=(0,n.Sy)(e.rows[0]),u=(0,i.yl)(t,o);if(u){if(o.products&&Array.isArray(o.products)){let t=0;for(let e of o.products)e.product.id==u.product.id&&(o.products[t]=u),t++;let d=JSON.stringify(o.products);if(e=await a.Z.query("UPDATE projects SET products = $1 WHERE id = $2 RETURNING *;",[d,r.idProject]),0!==e.rowCount)return Response.json({success:!0,res:e},{status:200});throw Error("Erreur lors de la mise \xe0 jour du produit")}}else{null===o.products&&(o.products=[]),o.products.push(t);let u=JSON.stringify(o.products);if(e=await a.Z.query("UPDATE projects SET products = $1 WHERE id = $2 RETURNING *;",[u,r.idProject]),0!==e.rowCount)return Response.json({success:!0,res:e},{status:200});throw Error("Erreur lors de la mise \xe0 jour du produit")}}return Response.json({success:!0,storeData:t},{status:200})}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du produit:",e),Response.json({success:!1,error:e},{status:500})}}let c=new u.AppRouteRouteModule({definition:{kind:d.x.APP_ROUTE,page:"/api/project/addProduct/route",pathname:"/api/project/addProduct",filename:"route",bundlePath:"app/api/project/addProduct/route"},resolvedPagePath:"C:\\Users\\trist\\Moduloop\\Moduloop-TristanHourtoulle\\app\\api\\project\\addProduct\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:E,serverHooks:w,headerHooks:f,staticGenerationBailout:j}=c,R="/api/project/addProduct/route";function m(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:E})}},7727:(e,r,t)=>{t.d(r,{Z:()=>d});let{Pool:o}=t(35900),u=new o({host:"localhost",user:"postgres",password:"root",database:"Moduloop"});u.query(`
    CREATE TRIGGER update_projects_modtime
    BEFORE UPDATE ON projects
    FOR EACH ROW
    EXECUTE PROCEDURE update_modified_column();
`,(e,r)=>{e&&console.error(e)});let d=u},97754:(e,r,t)=>{function o(e){return{id:e.id,name:e.name,image:e.image,unit:e.unit,base:e.base,new:e.new,reuse:e.reuse}}function u(e){return{id:e.id,name:e.name,description:e.description,image:e.image,budget:e.budget,products:e.products,company:e.company,location:e.location,area:e.area,user_id:e.user_id,group:e.group_id,created_at:e.created_at,updated_at:e.updated_at,groupInfo:null}}t.d(r,{Rl:()=>o,Sy:()=>u})},84586:(e,r,t)=>{function o(e,r){let t=null;if(r.products){for(let o of r.products)if(Number(o.product.id)==Number(e.product.id)){t={product:e.product,idProject:e.idProject,qNew:e.qNew+o.qNew,qUsed:e.qUsed+o.qUsed,addOn:o.addOn,updatedOn:e.updatedOn};break}}return t}function u(e,r){let t=[];for(let o of r)o.product.id!==e&&t.push(o);return t}t.d(r,{DC:()=>u,yl:()=>o})},95419:(e,r,t)=>{e.exports=t(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638],()=>t(85223));module.exports=o})();
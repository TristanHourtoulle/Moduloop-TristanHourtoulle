"use strict";(()=>{var e={};e.id=608,e.ids=[608],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},11160:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>R,patchFetch:()=>w,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var o={};t.r(o),t.d(o,{POST:()=>n});var u=t(95419),a=t(69108),s=t(99678),d=t(7727),i=t(97754);async function n(e){let r=await e.json();try{let e=await d.Z.query("SELECT * FROM products WHERE id = $1",[r.product.id]);if(0===e.rowCount)throw Error("Le produit n'existe pas");{let t={product:(0,i.Rl)(e.rows[0]),idProject:r.idProject,qNew:r.qNew,qUsed:r.qUsed,addOn:Date.now().toString(),updatedOn:Date.now().toString()};if(e=await d.Z.query("SELECT * FROM projects WHERE id = $1",[r.idProject]),0===e.rowCount)throw Error("Le projet n'existe pas");{let t=(0,i.Sy)(e.rows[0]);if(t.products&&Array.isArray(t.products)){let o=0;for(let e of t.products)e.product.id==r.product.id&&(t.products[o]=r),o++;let u=JSON.stringify(t.products);if(e=await d.Z.query("UPDATE projects SET products = $1 WHERE id = $2 RETURNING *;",[u,r.idProject]),0!==e.rowCount)return Response.json({success:!0,res:e},{status:200});throw Error("Erreur lors de la mise \xe0 jour du produit")}}return Response.json({success:!0,storeData:t},{status:200})}}catch(e){return console.error("Erreur lors de la r\xe9cup\xe9ration du produit:",e),Response.json({success:!1,error:e},{status:500})}}let p=new u.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/project/changeProduct/route",pathname:"/api/project/changeProduct",filename:"route",bundlePath:"app/api/project/changeProduct/route"},resolvedPagePath:"C:\\Users\\trist\\Moduloop\\Moduloop-TristanHourtoulle\\app\\api\\project\\changeProduct\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:E,headerHooks:g,staticGenerationBailout:m}=p,R="/api/project/changeProduct/route";function w(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:l})}},7727:(e,r,t)=>{t.d(r,{Z:()=>a});let{Pool:o}=t(35900),u=new o({host:"localhost",user:"postgres",password:"root",database:"Moduloop"});u.query(`
    CREATE TRIGGER update_projects_modtime
    BEFORE UPDATE ON projects
    FOR EACH ROW
    EXECUTE PROCEDURE update_modified_column();
`,(e,r)=>{e&&console.error(e)});let a=u},97754:(e,r,t)=>{function o(e){return{id:e.id,name:e.name,image:e.image,unit:e.unit,base:e.base,new:e.new,reuse:e.reuse}}function u(e){return{id:e.id,name:e.name,description:e.description,image:e.image,budget:e.budget,products:e.products,company:e.company,location:e.location,area:e.area,user_id:e.user_id,group:e.group_id,created_at:e.created_at,updated_at:e.updated_at,groupInfo:null}}t.d(r,{Rl:()=>o,Sy:()=>u})},95419:(e,r,t)=>{e.exports=t(30517)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638],()=>t(11160));module.exports=o})();